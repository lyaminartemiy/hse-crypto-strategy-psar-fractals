# Торговая система на основе комбинации PSAR, фракталов и ATR: оптимизация и тестирование на криптовалютном рынке
### **Лямин А.Д.** | Анализ финансовых рынков (Технический анализ) | Факультет экономических наук, НИУ ВШЭ

В работе представлена разработка и эмпирическая оценка торговой системы, использующей комбинацию трех технических индикаторов: параболического SAR (PSAR), фракталов Билла Вильямса и среднего истинного диапазона (ATR). Система реализована на языке `Python` с использованием библиотек для финансового анализа. Оптимизация параметров проводилась на периоде с января 2022 по декабрь 2024 года с применением фреймворка `Optuna`. Тестирование осуществлялось на независимом периоде с января 2025 года.

Для анализа использовались дневные данные по Bitcoin (BTC-USD) за период с 1 января 2022 года по 10 июля 2025 года. Данные получены через `API Yahoo Finance`. Общий объем выборки составляет 1287 торговых дней. Выбор криптовалюты в качестве базового актива обусловлен:
- Высокой ликвидностью рынка
- Непрерывностью торгов (24/7)
- Отсутствием дивидендных выплат, упрощающим анализ

# Индикаторы

### **Parabolic SAR (PSAR)**

Параболический SAR разработан Дж. Уэллсом Уайлдером-младшим. Индикатор генерирует точки (Stop and Reverse), расположенные ниже цены при восходящем тренде и выше цены при нисходящем. Формально, значение PSAR на момент $t$ вычисляется как:

\begin{equation}
SAR_t = SAR_{t-1} + AF \times (EP - SAR_{t-1})
\end{equation}

где $AF$ — фактор ускорения (начальное значение 0.02, увеличивается на 0.02 при каждом новом экстремуме до максимума 0.20), $EP$ — экстремальная цена (максимум для бычьего тренда, минимум для медвежьего).

### **Фракталы Билла Вильямса**

Фракталы идентифицируют локальные максимумы и минимумы на основе паттерна из пяти свечей. Для фрактала максимума:

\begin{equation}
\begin{aligned}
&High_t > High_{t-2} \\
&High_t > High_{t-1} \\
&High_t > High_{t+1} \\
&High_t > High_{t+2}
\end{aligned}
\end{equation}

Аналогично для фрактала минимума:

\begin{equation}
\begin{aligned}
&Low_t < Low_{t-2} \\
&Low_t < Low_{t-1} \\
&Low_t < Low_{t+1} \\
&Low_t < Low_{t+2}
\end{aligned}
\end{equation}

### **Average True Range (ATR)**

ATR измеряет волатильность рынка, учитывая гэпы между свечами. Истинный диапазон (True Range) определяется как:

\begin{equation}
TR_t = \max(High_t - Low_t, |High_t - Close_{t-1}|, |Low_t - Close_{t-1}|)
\end{equation}

ATR представляет собой скользящее среднее TR за период $N$:

\begin{equation}
ATR_t = \frac{1}{N}\sum_{i=t-N+1}^{t} TR_i
\end{equation}

# Стратегия

Система работает по следующим правилам:

- Вход в позицию (`Long`):
\begin{equation}
(Close_t > PSAR_t) and (ATR_t > SMA(ATR, M)_t) and (Close_t > FractalLow_{t-1})
\end{equation}

- Выход из позиции:

\begin{equation}
Close_t < PSAR_t or has FractalHigh_t
\end{equation}

где $SMA(ATR, M)$ — простое скользящее среднее ATR за период $M$.

# Оптимизация

Для оптимизации параметров использовался фреймворк `Optuna`.

Целевая функция — максимизация коэффициента Шарпа, рассчитываемого как:

\begin{equation}
Sharpe = \frac{\bar{R} \times \sqrt{252}}{\sigma_R}
\end{equation}

где $\bar{R}$ — средняя дневная доходность, $\sigma_R$ — стандартное отклонение дневной доходности.

Период оптимизации: 1 января 2022 — 31 декабря 2024 (756 торговых дней). Проведено 50 итераций оптимизации.

## Выводы

В работе представлена и протестирована торговая система, основанная на комбинации PSAR, фракталов и ATR. Полученные результаты демонстрируют, что предложенная комбинация индикаторов может быть эффективна для торговли на высоковолатильных рынках, таких как криптовалютный. Однако для практического применения необходима дополнительная проверка устойчивости системы на более длительных периодах и с учетом транзакционных издержек.

Хотя тестирование на независимом периоде снижает риск переобучения, параметры были оптимизированы на конкретном историческом периоде.
В расчетах не учитывались комиссии, которые могут существенно повлиять на результаты при частых сделках.
Система не использует short-позиции, что ограничивает ее применение на медвежьих рынках.

Перспективные направления для дальнейших исследований включают:
- Расширение системы для работы с short-позициями
- Тестирование на других классах активов (акции, валюты, товары)
- Включение машинного обучения для динамической адаптации параметров
- Учет транзакционных издержек и slippage

Основной код системы доступен на GitHub: https://github.com/lyaminartemiy/hse-crypto-strategy-psar-fractals.